<!DOCTYPE html>
<html
  lang="zh-cn"
  itemscope
  itemtype="http://schema.org/WebPage"
>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>
          Java后端-中间件-Kafka-1 - 会写代码的小郎中
        </title>
    

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="会写代码的小郎中" /><meta name="description" content="Kafka 核心架构与底层原理" />
<meta name="keywords" content="中间件" />







<meta name="generator" content="Hugo 0.128.2" />


<link rel="canonical" href="https://yutao.org/programming/java%E5%90%8E%E7%AB%AF-%E4%B8%AD%E9%97%B4%E4%BB%B6-kafka-1/" />





<link rel="icon" href="https://yutao.org/favicon.ico" />











<link rel="stylesheet" href="https://yutao.org/sass/jane.min.e826e860368147e5a6685e686355e4d7789023c18c9ea2e78b35f6786ce92736.css" integrity="sha256-6CboYDaBR&#43;WmaF5oY1Xk13iQI8GMnqLnizX2eGzpJzY=" media="screen" crossorigin="anonymous">






<link rel="stylesheet" href="https://yutao.org/css/custom.css">

<link rel="stylesheet" href="https://yutao.org/css/copy-to-clipboard.css">


<meta property="og:url" content="https://yutao.org/programming/java%E5%90%8E%E7%AB%AF-%E4%B8%AD%E9%97%B4%E4%BB%B6-kafka-1/">
  <meta property="og:site_name" content="会写代码的小郎中">
  <meta property="og:title" content="Java后端-中间件-Kafka-1">
  <meta property="og:description" content="Kafka 核心架构与底层原理">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="programming">
    <meta property="article:published_time" content="2025-09-08T15:27:57+08:00">
    <meta property="article:modified_time" content="2025-09-08T15:27:57+08:00">
    <meta property="article:tag" content="中间件">

  <meta itemprop="name" content="Java后端-中间件-Kafka-1">
  <meta itemprop="description" content="Kafka 核心架构与底层原理">
  <meta itemprop="datePublished" content="2025-09-08T15:27:57+08:00">
  <meta itemprop="dateModified" content="2025-09-08T15:27:57+08:00">
  <meta itemprop="wordCount" content="5613">
  <meta itemprop="keywords" content="中间件">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Java后端-中间件-Kafka-1">
  <meta name="twitter:description" content="Kafka 核心架构与底层原理">

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->


  
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-HZM2P746RY"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-HZM2P746RY');
        }
      </script>
    
  









  </head>
  <body>
    <div id="back-to-top"></div>

    <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="https://yutao.org/" class="logo">会写代码的小郎中</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://yutao.org/">主页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://yutao.org/programming/">编程</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://yutao.org/tcm/">中医</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://yutao.org/philosophy/">哲学</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://yutao.org/archives/">归档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://yutao.org/categories/">分类</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://yutao.org/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://yutao.org/about/">关于</a>
          
        
      </li>
    

    
  </ul>
</nav>


    
      






  <link rel="stylesheet" href="https://yutao.org/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="https://yutao.org/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

    

    

    <header id="header" class="header">
      <div class="logo-wrapper">
    <a href="https://yutao.org/" class="logo">
        
        会写代码的小郎中
        
    </a>
</div>

<nav class="site-navbar">
    <ul id="menu" class="menu">
        
        
        <li class="menu-item">
            
            
            
            <a class="menu-item-link" href="https://yutao.org/">主页</a>
            

            

        </li>
        
        <li class="menu-item">
            
            
            
            <a class="menu-item-link" href="https://yutao.org/programming/">编程</a>
            

            

        </li>
        
        <li class="menu-item">
            
            
            
            <a class="menu-item-link" href="https://yutao.org/tcm/">中医</a>
            

            

        </li>
        
        <li class="menu-item">
            
            
            
            <a class="menu-item-link" href="https://yutao.org/philosophy/">哲学</a>
            

            

        </li>
        
        <li class="menu-item">
            
            
            
            <a class="menu-item-link" href="https://yutao.org/archives/">归档</a>
            

            

        </li>
        
        <li class="menu-item">
            
            
            
            <a class="menu-item-link" href="https://yutao.org/categories/">分类</a>
            

            

        </li>
        
        <li class="menu-item">
            
            
            
            <a class="menu-item-link" href="https://yutao.org/tags/">标签</a>
            

            

        </li>
        
        <li class="menu-item">
            
            
            
            <a class="menu-item-link" href="https://yutao.org/about/">关于</a>
            

            

        </li>
        

        
        

        
    </ul>
</nav>
    </header>

    <div id="mobile-panel">
      <main id="main" class="main bg-llight wallpaper">
        <div class="content-wrapper">
    <div id="content" class="content">

        
        
        
        <script type="application/ld+json">
        {
          "@context": "https://schema.org",
          "@type": "BlogPosting",
          "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/yutao.org\/programming\/java%E5%90%8E%E7%AB%AF-%E4%B8%AD%E9%97%B4%E4%BB%B6-kafka-1\/"
          },
          "headline": "Java后端-中间件-Kafka-1",
          "description": "Kafka 核心架构与底层原理",
          "datePublished": "2025-09-08T15:27:57\u002b08:00",
          "dateModified": "2025-09-08T15:27:57\u002b08:00",
          "author": {
            "@type": "Person",
            "name": "会写代码的小郎中"
          },
          "publisher": {
            "@type": "Organization",
            "name": "会写代码的小郎中",
            "logo": {
              "@type": "ImageObject",
              "url": "https:\/\/yutao.org\/favicon.ico"
            }
          }
        }
        </script>
        
        

        <article class="post">
            
            <header class="post-header">
                <h1 class="post-title">Java后端-中间件-Kafka-1</h1>
                

                <div class="post-meta">
  <div class="post-meta-author">
    by
      <a href="https://yutao.org/about">
        <span class="post-meta-author-name">
          会写代码的小郎中
        </span>
      </a>
    
  </div>

  <div class="post-meta-time">
    <time datetime="2025-09-08">
      2025-09-08
    </time>
  </div>

  


  <div class="post-meta__right">
    <span class="post-meta-more">
        约 5613 字 -
        预计阅读 12 分钟
      </span>

    <div class="post-meta-category">
        <a href="https://yutao.org/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"> 中间件 </a>
          
      </div>


    
    
      <span id="busuanzi_container_page_pv">
        | 阅读 <span id="busuanzi_value_page_pv"></span>
      </span>
    


    
    
  </div>
</div>

            </header>

            
            <div class="post-content">
                <h1 id="kafka核心架构与底层原理">Kafka核心架构与底层原理</h1>
<h2 id="1-什么是-kafka">1. 什么是 Kafka</h2>
<p>Kafka 是一个<strong>分布式消息队列系统</strong>，最初由 LinkedIn 开发，现已成为 Apache 顶级项目。Kafka 的核心特性包括：</p>
<ul>
<li>高吞吐量：每秒百万级消息处理能力</li>
<li>可扩展性：通过分区和集群扩展</li>
<li>持久化：消息存储在磁盘上，可靠性高</li>
<li>支持流处理：可与 Kafka Streams、Flink 等实时处理框架结合</li>
</ul>
<h3 id="11-kafka-与传统消息队列的区别">1.1 Kafka 与传统消息队列的区别</h3>
<table>
<thead>
<tr>
<th>特性</th>
<th>RabbitMQ / ActiveMQ</th>
<th>Kafka</th>
</tr>
</thead>
<tbody>
<tr>
<td>消息模型</td>
<td>队列 / Topic</td>
<td>Topic + Partition</td>
</tr>
<tr>
<td>存储方式</td>
<td>内存 + 磁盘</td>
<td>磁盘持久化为主</td>
</tr>
<tr>
<td>消费模式</td>
<td>push</td>
<td>pull</td>
</tr>
<tr>
<td>高吞吐量</td>
<td>中</td>
<td>高</td>
</tr>
<tr>
<td>顺序保证</td>
<td>单队列</td>
<td>单分区内顺序保证</td>
</tr>
<tr>
<td>消息保留</td>
<td>消息被消费后删除</td>
<td>可配置时间/大小保留</td>
</tr>
</tbody>
</table>
<h2 id="2-kafka核心概念与架构设计">2. Kafka核心概念与架构设计</h2>
<h3 id="21-核心定义">2.1 <strong>核心定义</strong></h3>
<p>Kafka是分布式流处理平台，核心价值在于高吞吐量、持久化存储与流式处理能力。与传统消息队列（如RabbitMQ）的本质区别在于：</p>
<ul>
<li>采用<strong>分区（Partition）+ 副本（Replica）</strong> 实现分布式存储</li>
<li>基于磁盘顺序写入实现高吞吐（顺序IO性能接近内存）</li>
<li>消费者采用Pull模式，支持批量拉取与流量控制</li>
</ul>
<h3 id="22-核心组件解析">2.2 <strong>核心组件解析</strong></h3>
<ul>
<li>
<p><strong>主题（Topic）</strong>
消息的分类容器，类似数据库的“表”。生产者将消息发送到指定 Topic，消费者从 Topic 订阅消息。一个 Kafka 集群可以创建多个 Topic，每个 Topic 是消息的逻辑集合。</p>
</li>
<li>
<p><strong>分区（Partition）</strong>
每个 Topic 被划分为多个 <strong>分区（Partition）</strong>，分区是 Kafka 实现高吞吐量和并行处理的核心。</p>
<ul>
<li>分区是 <strong>有序的、不可变的消息序列</strong>，消息按写入顺序存储在分区中，每个消息在分区内有唯一的 <strong>偏移量（Offset）</strong>（类似数组下标，从 0 开始）。</li>
<li>分区是分布式存储的基本单位，不同分区可分布在不同 broker 节点上，实现负载均衡。</li>
</ul>
</li>
<li>
<p><strong>Broker</strong>
运行 Kafka 服务的服务器节点，一个 Kafka 集群由多个 Broker 组成。Broker 负责存储消息、处理生产者/消费者的请求，并维护分区的副本（Replication）以保证可靠性。</p>
</li>
<li>
<p><strong>生产者（Producer）</strong>
向 Topic 发送消息的客户端。生产者可指定消息发送到哪个分区（通过分区策略，如按 key 哈希、轮询等），若不指定则由 Kafka 自动分配。</p>
</li>
<li>
<p><strong>消费者（Consumer）</strong>
从 Topic 订阅并消费消息的客户端。消费者通过 <strong>消费者组（Consumer Group）</strong> 协同工作：</p>
<ul>
<li>一个消费者组内的多个消费者共同消费一个 Topic 的所有分区，<strong>每个分区只能被组内一个消费者消费</strong>（避免重复消费）。</li>
<li>不同消费者组可独立消费同一 Topic（互不影响）。</li>
</ul>
</li>
<li>
<p><strong>副本（Replica）</strong>
为保证数据可靠性，每个分区可配置多个 <strong>副本</strong>（包括 1 个 <strong>leader 副本</strong> 和多个 <strong>follower 副本</strong>）：</p>
<ul>
<li><strong>leader 副本</strong>：负责处理生产者和消费者的所有读写请求。</li>
<li><strong>follower 副本</strong>：从 leader 同步数据，当 leader 故障时，通过选举机制从 follower 中选出新的 leader，实现故障转移。</li>
</ul>
</li>
<li>
<p><strong>控制器（Controller）</strong>
集群中某个 Broker 会被选举为 <strong>控制器</strong>，负责管理集群元数据（如分区副本分配、leader 选举、Broker 加入/离开集群等），确保集群稳定运行。</p>
</li>
</ul>
<h3 id="23-架构拓扑图">2.3 <strong>架构拓扑图</strong></h3>
<div class="highlight"><div style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-1"> 1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-2"> 2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-3"> 3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-4"> 4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-5"> 5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-6"> 6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-7"> 7</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-8"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-8"> 8</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-9"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-9"> 9</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-10"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-10">10</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-11"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-11">11</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-12"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-12">12</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-13"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-13">13</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-14"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-14">14</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-15"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-15">15</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-16"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-16">16</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-17"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-17">17</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-18"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-18">18</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-19"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-19">19</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-20"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-20">20</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-0-21"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-0-21">21</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>                  ┌─────────────┐
</span></span><span style="display:flex;"><span>                  │  Producer   │  发送消息
</span></span><span style="display:flex;"><span>                  └──────┬──────┘
</span></span><span style="display:flex;"><span>                         │
</span></span><span style="display:flex;"><span>                         ▼
</span></span><span style="display:flex;"><span>┌─────────────┐  ┌─────────────┐  ┌─────────────┐
</span></span><span style="display:flex;"><span>│  Broker 1   │  │  Broker 2   │  │  Broker 3   │  （集群）
</span></span><span style="display:flex;"><span>│  - Topic A  │  │  - Topic A  │  │  - Topic A  │
</span></span><span style="display:flex;"><span>│    分区 0    │  │    分区 1    │  │    分区 2    │  （Topic A 分为 3 个分区）
</span></span><span style="display:flex;"><span>│  - 副本     │  │  - 副本     │  │  - 副本     │
</span></span><span style="display:flex;"><span>└──────┬──────┘  └──────┬──────┘  └──────┬──────┘
</span></span><span style="display:flex;"><span>       │                │                │
</span></span><span style="display:flex;"><span>       └────────┬───────┴────────┬───────┘
</span></span><span style="display:flex;"><span>                │                │
</span></span><span style="display:flex;"><span>                ▼                ▼
</span></span><span style="display:flex;"><span>┌─────────────┐          ┌─────────────┐
</span></span><span style="display:flex;"><span>│Consumer Group 1       │Consumer Group 2
</span></span><span style="display:flex;"><span>│  - Consumer 1 (分区0)  │  - Consumer X (分区0)
</span></span><span style="display:flex;"><span>│  - Consumer 2 (分区1)  │  - Consumer Y (分区1)
</span></span><span style="display:flex;"><span>│  - Consumer 3 (分区2)  │  - Consumer Z (分区2)
</span></span><span style="display:flex;"><span>└─────────────┘          └─────────────┘
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="3-消息存储与读写机制">3. 消息存储与读写机制</h2>
<h3 id="31-分区的文件存储结构">3.1 <strong>分区的文件存储结构</strong></h3>
<p>每个分区在磁盘上对应一个独立的目录（命名规则：<code>Topic名-分区号</code>，如 <code>topicA-0</code>），目录内包含两类核心文件：</p>
<ul>
<li>
<p><strong>日志文件（Log Segments）</strong>：存储实际消息数据，按大小或时间拆分为多个 <strong>段文件（Segment）</strong>，避免单个文件过大。
每个段文件包含：</p>
<ul>
<li><code>.log</code> 文件：二进制格式存储消息（消息内容、偏移量、时间戳、键等）。</li>
<li><code>.index</code> 文件：索引文件，记录消息偏移量与 <code>.log</code> 文件中物理位置的映射（类似字典，加速消息查找）。</li>
<li><code>.timeindex</code> 文件：按时间戳索引，用于按时间范围查询消息。</li>
</ul>
</li>
<li>
<p><strong>其他元数据文件</strong>：如 <code>leader-epoch-checkpoint</code>（记录分区 leader 的纪元信息，用于故障恢复）。</p>
<p>段文件滚动策略：</p>
</li>
<li>
<p>大小触发：默认1GB（<code>log.segment.bytes</code>）</p>
</li>
<li>
<p>时间触发：默认7天（<code>log.roll.hours</code>）</p>
</li>
</ul>
<h3 id="32-消息写入流程">3.2 <strong>消息写入流程</strong></h3>
<div class="highlight"><div style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-1">1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-2">2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-3">3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-4">4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-1-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-1-5">5</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic">// 生产者核心配置（高性能调优）</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>props.<span style="color:#4070a0">put</span>(ProducerConfig.<span style="color:#4070a0">BATCH_SIZE_CONFIG</span>,<span style="color:#bbb"> </span>16384);<span style="color:#bbb"> </span><span style="color:#60a0b0;font-style:italic">// 16KB批处理大小</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>props.<span style="color:#4070a0">put</span>(ProducerConfig.<span style="color:#4070a0">LINGER_MS_CONFIG</span>,<span style="color:#bbb"> </span>5);<span style="color:#bbb"> </span><span style="color:#60a0b0;font-style:italic">// 5ms延迟等待批满</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>props.<span style="color:#4070a0">put</span>(ProducerConfig.<span style="color:#4070a0">COMPRESSION_TYPE_CONFIG</span>,<span style="color:#bbb"> </span><span style="color:#4070a0">&#34;snappy&#34;</span>);<span style="color:#bbb"> </span><span style="color:#60a0b0;font-style:italic">// 启用压缩</span><span style="color:#bbb">
</span></span></span><span style="display:flex;"><span><span style="color:#bbb"></span>props.<span style="color:#4070a0">put</span>(ProducerConfig.<span style="color:#4070a0">ACKS_CONFIG</span>,<span style="color:#bbb"> </span><span style="color:#4070a0">&#34;all&#34;</span>);<span style="color:#bbb"> </span><span style="color:#60a0b0;font-style:italic">// 等待所有ISR确认</span><span style="color:#bbb">
</span></span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>生产者发送消息到 Topic 的 leader 分区。</li>
<li>消息被追加到 leader 分区的当前 <code>.log</code> 段文件末尾（<strong>顺序写入</strong>，磁盘顺序写入性能接近内存）。</li>
<li>follower 副本定期从 leader 同步新消息（拉取模式），保持数据一致。replica.fetch.max.bytes控制拉取量。</li>
<li>当 <code>.log</code> 文件达到配置的大小（如 1GB）或时间（如 7 天），会创建新的段文件，旧文件不再写入。</li>
<li>Topic 分区的写入规则：<strong>不是按“写满一个再写下一个”的顺序写入</strong>，而是由<strong>生产者的分区策略</strong>决定消息写入哪个分区。默认情况下，生产者发送消息到 Topic 时的分区选择逻辑：<strong>如果消息指定了 key</strong>：Kafka 会对 key 进行哈希计算，将相同 key 的消息分配到<strong>同一个分区</strong>（保证同一 key 的消息有序性）。<strong>如果消息没有指定 key</strong>：采用<strong>轮询（Round Robin）策略</strong>，将消息均匀分发到 Topic 的各个分区（而非写满一个再写下一个）。</li>
</ul>
<p>举例：Topic A 有 3 个分区（0、1、2），未指定 key 的消息会按顺序依次写入 0→1→2→0→1→2…，实现负载均衡。</p>
<p>这种设计的目的是<strong>并行写入</strong>：多个分区可以同时接收消息，大幅提高吞吐量（如果按“写满一个再写下一个”，只能单分区写入，性能会很低）。</p>
<h3 id="33-消息消费流程">3.3 <strong>消息消费流程</strong></h3>
<ul>
<li>消费者指定要消费的分区和起始偏移量（或通过 <code>auto.offset.reset</code> 策略自动选择）。</li>
<li>Kafka 根据偏移量查找对应的段文件（通过 <code>.index</code> 索引快速定位 <code>.log</code> 文件中的物理位置）。</li>
<li>从 <code>.log</code> 文件中读取消息并返回给消费者。</li>
<li>消费者消费后，会提交已消费的偏移量（记录在 <code>__consumer_offsets</code>  Topic 中，避免重复消费）。</li>
<li>消费者通过<code>fetch.min.bytes</code>和<code>fetch.max.wait.ms</code>控制批量拉取策略</li>
<li>分区分配策略：
<ul>
<li>Range（默认）：按分区序号均分，可能导致分配不均</li>
<li>RoundRobin：全量分区轮询分配，适合多Topic场景</li>
<li>Sticky：优先保持现有分配，减少重平衡开销</li>
</ul>
</li>
<li>消费组与分区的消费规则：<strong>一个分区只能被同一个消费组内的一个消费者消费，但一个消费者可以消费多个分区</strong>。</li>
</ul>
<p>举例：Topic A 有 3 个分区（0、1、2），消费组 A 有 3 个消费者（C1、C2、C3）：</p>
<ul>
<li>通常会按“一对一”分配：C1 消费分区 0，C2 消费分区 1，C3 消费分区 2（每个消费者负责一个分区）。</li>
<li>若消费组只有 2 个消费者（C1、C2）：可能 C1 消费分区 0 和 1，C2 消费分区 2（一个消费者可以处理多个分区）。</li>
<li>若消费组有 4 个消费者：必然有 1 个消费者空闲（因为只有 3 个分区，最多需要 3 个消费者）。</li>
</ul>
<p>核心原则：<strong>分区数决定了消费组的最大并行度</strong>（消费组内消费者数量超过分区数时，多余的消费者不会分配到任务）。</p>
<p>这样设计的原因是<strong>保证分区内消息的有序性</strong>：如果一个分区被多个消费者同时消费，会导致消息顺序混乱（因为每个消费者处理速度不同）。</p>
<h3 id="34-消息清理机制">3.4 <strong>消息清理机制</strong></h3>
<p>Kafka 不会永久存储消息，通过两种策略清理过期数据：</p>
<ul>
<li><strong>日志保留时间</strong>：超过配置时间（如 7 天）的段文件会被删除（默认策略）。</li>
<li><strong>日志保留大小</strong>：当分区总大小超过配置值（如 10GB）， oldest 的段文件会被删除。</li>
<li>此外，还支持 <strong>日志压缩（Log Compaction）</strong>：只保留每个 key 最新的消息，适用于需要保留最新状态的场景（如用户配置）。</li>
</ul>
<h3 id="35-消息的序号偏移量-offset和消费组的订阅机制">3.5 <strong>消息的序号（偏移量 Offset）和消费组的订阅机制</strong></h3>
<p>Kafka 的消息序号（Offset）是<strong>每个分区独立维护的</strong>，而非全局统一编号：</p>
<ul>
<li>每个分区的 Offset 从 <code>0</code> 开始，消息按写入该分区的顺序依次递增（<code>0,1,2,3...</code>）。</li>
<li>不同分区的 Offset 相互独立，没有关联。</li>
</ul>
<p>举例：
Topic A 有 3 个分区（0、1、2），消息写入顺序如下：</p>
<ol>
<li>消息 M1 写入分区 0 → Offset=0</li>
<li>消息 M2 写入分区 2 → Offset=0</li>
<li>消息 M3 写入分区 1 → Offset=0</li>
<li>消息 M4 写入分区 0 → Offset=1</li>
<li>消息 M5 写入分区 2 → Offset=1</li>
</ol>
<p>此时各分区的 Offset 是：</p>
<ul>
<li>分区 0：<code>[M1(0), M4(1)]</code></li>
<li>分区 1：<code>[M3(0)]</code></li>
<li>分区 2：<code>[M2(0), M5(1)]</code></li>
</ul>
<h3 id="36-消费组与分区的订阅消费机制">3.6 <strong>消费组与分区的订阅/消费机制</strong></h3>
<ol>
<li>
<p><strong>订阅对象</strong>：
消费组是<strong>整体订阅 Topic</strong>，而非某个消费者单独订阅分区。例如，消费组 A 订阅 Topic A 后，组内的消费者会<strong>共同分担</strong>该 Topic 所有分区的消费任务。</p>
</li>
<li>
<p><strong>分区分配逻辑</strong>：
Kafka 会自动将 Topic 的分区<strong>均匀分配</strong>给消费组内的消费者（由 <code>partition.assignment.strategy</code> 配置决定，默认是range或round-robin策略）。</p>
<ul>
<li>如 Topic A 有 3 个分区，消费组 A 有 3 个消费者（C1、C2、C3）：
C1 → 分区 0，C2 → 分区 1，C3 → 分区 2（一对一分配）。</li>
<li>若消费组只有 2 个消费者：
C1 → 分区 0 和 1，C2 → 分区 2（一个消费者可消费多个分区）。</li>
</ul>
</li>
<li>
<p><strong>消费时的 Offset 处理</strong>：</p>
<ul>
<li>每个消费者只处理分配给自己的分区，按分区内的 Offset 顺序消费（从 0 开始，依次递增）。</li>
<li>消费组会记录每个分区的<strong>已消费 Offset</strong>（默认存储在 Kafka 内部的 <code>__consumer_offsets</code> 主题中），确保重启后能从上次中断的位置继续消费。</li>
<li>例如：C1 消费分区 0 时，会按 <code>0→1→2...</code> 的顺序处理消息，消费完成后提交 Offset=1（表示已处理完 Offset≤1 的消息）。</li>
</ul>
</li>
</ol>
<h2 id="4高可用与可靠性保障">4.高可用与可靠性保障</h2>
<h3 id="41-副本同步机制">4.1 <strong>副本同步机制</strong></h3>
<ul>
<li>Leader维护HW（High Watermark）：所有ISR副本已同步的最大Offset</li>
<li>消费者只能读取HW以下的消息（避免消费未同步完成的数据）</li>
<li>配置项：<code>replica.lag.time.max.ms</code>（副本落后Leader超时踢出ISR，默认30s）</li>
</ul>
<h3 id="42-故障恢复流程">4.2 <strong>故障恢复流程</strong></h3>
<ul>
<li>Controller检测到Broker宕机后，触发分区Leader重选举</li>
<li>选举规则：ISR中存活副本优先，最小Leader epoch（避免数据不一致）</li>
</ul>
<h3 id="43-数据可靠性配置矩阵">4.3 <strong>数据可靠性配置矩阵</strong></h3>
<table>
<thead>
<tr>
<th>场景</th>
<th>acks配置</th>
<th>副本数</th>
<th>抗风险能力</th>
</tr>
</thead>
<tbody>
<tr>
<td>金融级（不丢消息）</td>
<td>all</td>
<td>≥3</td>
<td>容忍2节点故障</td>
</tr>
<tr>
<td>高吞吐（允许丢消息）</td>
<td>0</td>
<td>1</td>
<td>单节点故障即丢失数据</td>
</tr>
</tbody>
</table>
<h2 id="50-单分区吞吐量极限">5.0 单分区吞吐量极限</h2>
<p>Kafka单分区的吞吐量受硬件（磁盘IO、网络带宽）、消息大小、压缩方式等影响，生产环境中<strong>经验值</strong>如下：</p>
<ul>
<li>
<p><strong>写入（Producer）</strong>：</p>
<ul>
<li>普通机械盘：500-1000条/秒（非压缩，1KB消息）</li>
<li>SSD盘：2000-5000条/秒（非压缩，1KB消息）</li>
<li>启用压缩（snappy/lz4）：可提升2-5倍（视消息重复度）</li>
<li>极限值：单分区写入带宽建议不超过100MB/s（避免磁盘IO瓶颈）</li>
</ul>
</li>
<li>
<p><strong>读取（Consumer）</strong>：</p>
<ul>
<li>单消费者消费单分区：性能与写入相当（略高，因读缓存）</li>
<li>注意：消费端吞吐量受业务处理速度影响更大（如消费后需DB操作则可能成为瓶颈）</li>
</ul>
</li>
</ul>
<h3 id="51-分区数量计算公式">5.1 分区数量计算公式</h3>
<h4 id="1-基础公式按写入峰值计算">1. 基础公式（按写入峰值计算）</h4>
<pre tabindex="0"><code>分区总数 =  ceil( 峰值写入QPS / 单分区写入极限QPS )
</code></pre><ul>
<li><strong>峰值写入QPS</strong>：业务高峰期每秒产生的消息数（需预留30%-50%冗余应对突发流量）</li>
<li><strong>单分区写入极限QPS</strong>：根据硬件实测值（建议取保守值，如SSD环境按2000条/秒计算）</li>
</ul>
<p><strong>示例</strong>：<br>
某业务峰值写入5000条/秒（1KB消息，SSD盘），则分区数 = ceil(5000 / 2000) = 3个（预留冗余后建议4个）。</p>
<h4 id="2-进阶公式结合消费端能力">2. 进阶公式（结合消费端能力）</h4>
<p>若消费端处理较慢（如每条消息需复杂计算），需按消费能力二次验证：</p>
<pre tabindex="0"><code>消费所需分区数 = ceil( 峰值写入QPS / 单消费者处理QPS )
</code></pre><ul>
<li>最终分区数取<strong>写入所需分区数</strong>和<strong>消费所需分区数</strong>的最大值。</li>
</ul>
<p><strong>示例</strong>：<br>
写入需4个分区，但单消费者每秒只能处理1000条消息，则消费需5个分区（5000/1000），最终分区数取5。</p>
<h3 id="52-关键约束与调优原则">5.2 关键约束与调优原则</h3>
<ol>
<li>
<p><strong>分区数并非越多越好</strong>：</p>
<ul>
<li>过多分区会导致：ZooKeeper元数据膨胀（分区元数据存在ZK）、Leader选举耗时增加、日志文件句柄过多。</li>
<li>经验上限：单集群分区总数不超过10万（视Broker数量，每Broker建议≤2000个分区）。</li>
</ul>
</li>
<li>
<p><strong>与消费者数量匹配</strong>：</p>
<ul>
<li>消费者数量 ≤ 分区数（多余消费者会空闲），建议按“分区数 = 消费者数 × 1.5”设计（预留扩容空间）。</li>
</ul>
</li>
<li>
<p><strong>Topic拆分策略</strong>：</p>
<ul>
<li>若单Topic分区数需超过100，建议按业务子域拆分为多个Topic（如将<code>user-action</code>拆分为<code>user-login</code>、<code>user-purchase</code>）。</li>
</ul>
</li>
<li>
<p><strong>扩容考量</strong>：</p>
<ul>
<li>分区数创建后<strong>不可减少</strong>（只能增加），初期设计需预留1-2年业务增长空间（如按当前峰值的3倍计算）。</li>
</ul>
</li>
</ol>
<h3 id="53-企业级实践案例">5.3 企业级实践案例</h3>
<h4 id="案例1电商订单系统">案例1：电商订单系统</h4>
<ul>
<li>需求：日均订单1000万，峰值QPS=2000（1KB/条，SSD集群）</li>
<li>计算：<br>
写入所需分区 = ceil(2000 / 2000) = 1（加冗余后取3）<br>
消费端：3个消费者（每个处理666 QPS），与分区数匹配</li>
<li>最终方案：3个分区，2个副本（总存储6个分区副本）</li>
</ul>
<h4 id="案例2日志采集系统">案例2：日志采集系统</h4>
<ul>
<li>需求：日均日志10亿条，峰值QPS=5万（512B/条，启用snappy压缩）</li>
<li>计算：<br>
压缩后单分区写入极限≈4000条/秒（原2000×2）<br>
写入所需分区 = ceil(50000 / 4000) = 13（取16，便于消费者均匀分配）</li>
<li>最终方案：16个分区，3个副本（抗2节点故障）</li>
</ul>
<h3 id="54-验证与调整方法">5.4 验证与调整方法</h3>
<ol>
<li>
<p><strong>压测验证</strong>：<br>
使用官方工具<code>kafka-producer-perf-test.sh</code>实测单分区极限：</p>
<div class="highlight"><div style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-1"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-1">1</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-2"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-2">2</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-3"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-3">3</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-4"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-4">4</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-5"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-5">5</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-6"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-6">6</a>
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f" id="hl-4-7"><a style="outline:none;text-decoration:none;color:inherit" href="#hl-4-7">7</a>
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#60a0b0;font-style:italic"># 测试单分区写入性能（100万条1KB消息）</span>
</span></span><span style="display:flex;"><span>bin/kafka-producer-perf-test.sh <span style="color:#4070a0;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0;font-weight:bold"></span>  --topic test-topic <span style="color:#4070a0;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0;font-weight:bold"></span>  --record-size <span style="color:#40a070">1024</span> <span style="color:#4070a0;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0;font-weight:bold"></span>  --num-records <span style="color:#40a070">1000000</span> <span style="color:#4070a0;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0;font-weight:bold"></span>  --throughput -1 <span style="color:#4070a0;font-weight:bold">\
</span></span></span><span style="display:flex;"><span><span style="color:#4070a0;font-weight:bold"></span>  --producer-props bootstrap.servers<span style="color:#666">=</span>broker1:9092 <span style="color:#bb60d5">acks</span><span style="color:#666">=</span><span style="color:#40a070">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>动态调整</strong>：<br>
若生产环境出现以下情况，需增加分区：</p>
<ul>
<li>生产者端<code>batch.size</code>频繁满（监控<code>record-queue-time-avg</code>持续升高）</li>
<li>消费延迟（<code>consumer-lag</code>）持续增大且无法通过增加消费者解决</li>
</ul>
</li>
</ol>
<p>通过以上方法，可设计出既能满足当前吞吐量，又具备扩展性的分区方案，避免“分区过少瓶颈”或“分区过多运维难题”。核心原则是：<strong>以实测性能为基准，预留合理冗余，匹配消费能力</strong>。</p>
<h2 id="总结">总结</h2>
<p>程序员必知必会。</p>

            </div>

            
            
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">会写代码的小郎中</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
      2025-09-08
      
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content">CC BY-NC-ND 4.0</span>
  </p>
</div>



            
            
<div class="post-reward">
  <input type="checkbox" name="reward" id="reward" hidden />
  <label class="reward-button" for="reward">赞赏支持</label>
  <div class="qr-code">
    
    
      <label class="qr-code-image" for="reward">
        <img class="image" src="https://yutao.org/image/ds/wechat-qr-code.jpg">
        <span>微信打赏</span>
      </label>
    
      <label class="qr-code-image" for="reward">
        <img class="image" src="https://yutao.org/image/ds/alipay-qr-code.jpg">
        <span>支付宝打赏</span>
      </label>
  </div>
</div>


            <footer class="post-footer">
                <div class="post-tags">
                    <a href="https://yutao.org/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/">中间件</a>
                    
                </div>


                
                <nav class="post-nav">
                    
                    <a class="prev" href="https://yutao.org/programming/java%E5%90%8E%E7%AB%AF-%E4%B8%AD%E9%97%B4%E4%BB%B6-kafka-2/">
                        
                        <i class="iconfont">
                            <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

                        </i>
                        <span class="prev-text nav-default">Java后端-中间件-Kafka-2</span>
                        <span class="prev-text nav-mobile">上一篇</span>
                    </a>
                    
                    <a class="next" href="https://yutao.org/programming/java%E6%A1%86%E6%9E%B6-springcloud%E6%A1%86%E6%9E%B6-12/">
                        <span class="next-text nav-default">Java框架-SpringCloud框架-12</span>
                        <span class="prev-text nav-mobile">下一篇</span>
                        
                        <i class="iconfont">
                            <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

                        </i>
                    </a>
                </nav>
            </footer>
        </article>

        
        


        
        

  

  
  

  
  
    <div class="post">
  <script src="https://utteranc.es/client.js"
        repo= "yutaodev/comments-for-yutaodev.github.io"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
  </script>
</div>

  

  

  

    

  

  


    </div>

    
    <nav class="toc" id="toc">
    <div class="toc-title">文章目录</div>
    <div class="toc-content custom-scrollbar">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#1-什么是-kafka">1. 什么是 Kafka</a>
      <ul>
        <li><a href="#11-kafka-与传统消息队列的区别">1.1 Kafka 与传统消息队列的区别</a></li>
      </ul>
    </li>
    <li><a href="#2-kafka核心概念与架构设计">2. Kafka核心概念与架构设计</a>
      <ul>
        <li><a href="#21-核心定义">2.1 <strong>核心定义</strong></a></li>
        <li><a href="#22-核心组件解析">2.2 <strong>核心组件解析</strong></a></li>
        <li><a href="#23-架构拓扑图">2.3 <strong>架构拓扑图</strong></a></li>
      </ul>
    </li>
    <li><a href="#3-消息存储与读写机制">3. 消息存储与读写机制</a>
      <ul>
        <li><a href="#31-分区的文件存储结构">3.1 <strong>分区的文件存储结构</strong></a></li>
        <li><a href="#32-消息写入流程">3.2 <strong>消息写入流程</strong></a></li>
        <li><a href="#33-消息消费流程">3.3 <strong>消息消费流程</strong></a></li>
        <li><a href="#34-消息清理机制">3.4 <strong>消息清理机制</strong></a></li>
        <li><a href="#35-消息的序号偏移量-offset和消费组的订阅机制">3.5 <strong>消息的序号（偏移量 Offset）和消费组的订阅机制</strong></a></li>
        <li><a href="#36-消费组与分区的订阅消费机制">3.6 <strong>消费组与分区的订阅/消费机制</strong></a></li>
      </ul>
    </li>
    <li><a href="#4高可用与可靠性保障">4.高可用与可靠性保障</a>
      <ul>
        <li><a href="#41-副本同步机制">4.1 <strong>副本同步机制</strong></a></li>
        <li><a href="#42-故障恢复流程">4.2 <strong>故障恢复流程</strong></a></li>
        <li><a href="#43-数据可靠性配置矩阵">4.3 <strong>数据可靠性配置矩阵</strong></a></li>
      </ul>
    </li>
    <li><a href="#50-单分区吞吐量极限">5.0 单分区吞吐量极限</a>
      <ul>
        <li><a href="#51-分区数量计算公式">5.1 分区数量计算公式</a>
          <ul>
            <li><a href="#1-基础公式按写入峰值计算">1. 基础公式（按写入峰值计算）</a></li>
            <li><a href="#2-进阶公式结合消费端能力">2. 进阶公式（结合消费端能力）</a></li>
          </ul>
        </li>
        <li><a href="#52-关键约束与调优原则">5.2 关键约束与调优原则</a></li>
        <li><a href="#53-企业级实践案例">5.3 企业级实践案例</a>
          <ul>
            <li><a href="#案例1电商订单系统">案例1：电商订单系统</a></li>
            <li><a href="#案例2日志采集系统">案例2：日志采集系统</a></li>
          </ul>
        </li>
        <li><a href="#54-验证与调整方法">5.4 验证与调整方法</a></li>
      </ul>
    </li>
    <li><a href="#总结">总结</a></li>
  </ul>
</nav>
    </div>
  </nav>


    



<script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });  
</script>
<script>
    
    Array.from(document.getElementsByClassName("language-mermaid")).forEach(
        (el) => {
            el.parentElement.outerHTML = `<div class="mermaid">${el.innerHTML}</div>`;
        }
    );  
</script>
<style>
     
    .mermaid svg {
        display: block;
        margin: auto;
    }
</style>
</div>

      </main>

      <footer id="footer" class="footer">
        <div class="icon-links">
    
  
    <a href="mailto:yutao.z@qq.com" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://space.bilibili.com/304380559" rel="me noopener" class="iconfont"
      title="bilibili"  target="_blank"
      >
      <svg
  class="icon" style="" viewBox="0 0 1024 1024" version="1.1" width="36"
  height="36" id="svg8">
  <path
      style=""
      d="M 744.60599,0.00486267 A 41.779915,41.779915 0 0 0 710.4184,18.673394 L 548.5048,255.32642 h -11.70046 a 41.779915,41.779915 0 0 0 -10.80295,-7.84928 L 235.66,97.084498 a 41.779915,41.779915 0 0 0 -20.07193,-4.960864 41.779915,41.779915 0 0 0 -18.3748,79.145436 L 359.4859,255.32642 H 128.16909 c -49.458302,0 -89.27932,39.82105 -89.27932,89.27932 v 508.65224 c 0,49.4583 39.821018,89.27934 89.27932,89.27934 h 19.48445 C 149.12802,984.5043 179.92773,1024 224.79179,1024 c 44.86407,0 75.66379,-39.4957 77.13826,-81.46268 H 719.98116 C 721.45559,984.5043 752.25533,1024 797.1194,1024 c 44.86406,0 75.6638,-39.4957 77.13824,-81.46268 h 21.57323 c 49.45831,0 89.27936,-39.82104 89.27936,-89.27934 V 344.60574 c 0,-49.45827 -39.82105,-89.27932 -89.27936,-89.27932 H 649.74567 L 779.38103,65.866924 A 41.779915,41.779915 0 0 0 744.60599,0.00486267 Z M 644.49108,418.70871 c 6.29985,0.21538 12.44451,2.01107 17.86888,5.22196 l 171.36218,98.10771 c 18.23417,10.21935 24.63334,33.34627 14.24614,51.48533 -10.38726,18.13909 -33.57344,24.32718 -51.61587,13.77296 L 624.9903,489.18895 c -15.21356,-8.41858 -22.66871,-26.1765 -18.03211,-42.93436 4.63664,-16.75784 20.15573,-28.14465 37.53289,-27.54588 z M 350.2006,432.31846 c 16.89952,0.0317 31.69582,11.33328 36.17844,27.62747 4.48262,16.2942 -2.44981,33.57765 -16.95507,42.24898 l -140.7157,86.91312 c -17.68528,11.18244 -41.09629,5.77692 -52.08912,-12.02686 -10.99282,-17.80373 -5.33855,-41.15658 12.58167,-51.95857 L 329.9002,438.2095 c 6.0643,-3.86439 13.10951,-5.90891 20.3004,-5.89104 z M 501.605,641.53985 c 3.75002,-0.15248 7.48645,0.53903 10.93349,2.0235 0.15842,0.0637 0.31618,0.12888 0.47325,0.19582 0.59328,0.27092 1.17574,0.56489 1.74609,0.88121 0.15868,0.0854 0.31643,0.17233 0.47325,0.2611 0.55694,0.32165 1.10131,0.66458 1.63185,1.02807 0.16455,0.1123 0.32777,0.2265 0.48956,0.34269 0.50382,0.36781 0.99371,0.75428 1.46868,1.15864 0.18724,0.15504 0.37218,0.31282 0.55484,0.47323 0.43271,0.38784 0.8518,0.79061 1.25653,1.20756 0.15449,0.16114 0.30679,0.32437 0.45693,0.48959 0.40798,0.44266 0.79989,0.89988 1.17494,1.37076 0.17799,0.22544 0.35205,0.45395 0.5222,0.68538 0.25932,0.34701 0.50964,0.70071 0.75064,1.06071 0.26712,0.39516 0.52286,0.79784 0.76699,1.20757 0.16907,0.29043 0.33231,0.58424 0.48957,0.88123 0.21836,0.41297 0.42513,0.83199 0.62009,1.25653 0.14836,0.32333 0.28983,0.64976 0.42429,0.97911 0.21319,0.51552 0.40915,1.03801 0.58747,1.5666 0.0677,0.19499 0.13296,0.39085 0.19582,0.58748 0.18652,0.60823 0.34984,1.22334 0.48957,1.84399 0.0397,0.16277 0.0779,0.32601 0.11423,0.48957 0.1436,0.69112 0.25788,1.38801 0.34269,2.08877 0.005,0.0381 0.0111,0.0761 0.0163,0.11424 0.0857,0.78056 0.13474,1.56471 0.14687,2.34988 0.005,0.0543 0.0111,0.10879 0.0163,0.1632 0,0 -0.008,1.12132 0,1.45234 0,0 -0.14697,17.84761 5.89102,34.12231 3.01902,8.13734 7.33278,15.10615 12.61433,19.61501 5.28157,4.50889 11.42894,7.62081 23.64572,7.62081 12.2168,0 18.36416,-3.11192 23.64573,-7.62081 5.28154,-4.50886 9.5953,-11.47767 12.6143,-19.61501 6.03799,-16.2747 5.89103,-34.12231 5.89103,-34.12231 -0.44885,-13.87045 10.45922,-25.46302 24.3311,-25.86506 13.87189,-0.40201 25.42828,10.53953 25.78348,24.41272 0,0 1.11929,25.7226 -9.00791,53.01927 -5.06359,13.64832 -13.1986,28.46036 -27.05631,40.29073 -13.85772,11.83039 -33.5454,19.63135 -56.20142,19.63135 -22.65603,0 -42.34371,-7.80096 -56.20141,-19.63135 -4.1801,-3.56856 -7.78733,-7.42433 -10.99878,-11.42303 -3.21235,4.00037 -6.81703,7.85309 -10.99876,11.42303 -13.85773,11.83039 -33.5454,19.63135 -56.20144,19.63135 -22.65601,0 -42.3437,-7.80096 -56.2014,-19.63135 -13.85775,-11.83037 -21.99272,-26.64241 -27.05632,-40.29073 -10.12725,-27.29667 -9.00789,-53.01928 -9.00789,-53.01927 0.20714,-13.83687 11.58744,-24.88848 25.42444,-24.69013 14.1263,0.19991 25.2971,12.0278 24.69011,26.14247 0,0 -0.14697,17.84761 5.89103,34.12231 3.01902,8.13734 7.31646,15.10615 12.598,19.61501 5.28155,4.50889 11.44526,7.62081 23.66203,7.62081 12.21681,0 18.36418,-3.11192 23.64573,-7.62081 5.28154,-4.50886 9.57899,-11.47767 12.598,-19.61501 5.76352,-15.53489 5.89112,-32.05691 5.89103,-33.56746 0.006,-0.37466 0.0111,-1.05336 0.0163,-1.20759 -0.0117,-0.74583 0.0105,-1.49177 0.0652,-2.23565 0.009,-0.15784 0.0204,-0.31561 0.0327,-0.47324 0.14204,-1.56859 0.43163,-3.12027 0.86487,-4.63449 0.0213,-0.0763 0.0433,-0.15244 0.0652,-0.22848 3.0335,-10.25748 12.24157,-17.46007 22.92769,-17.93417 z"
      id="rect824"/>
</svg>

    </a>
  
    <a href="https://weibo.com/u/2557216280" rel="me noopener" class="iconfont"
      title="weibo"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M385.714286 733.714286q12-19.428571 6.285714-39.428571t-25.714286-28.571429q-19.428571-8-41.714286-0.571429t-34.285714 26.285714q-12.571429 19.428571-7.428571 39.142857t24.571429 28.857143 42.571429 1.428571 35.714286-27.142857zm53.714286-69.142857q4.571429-7.428571 2-15.142857t-10-10.571429q-8-2.857143-16.285714 2.857143t-12.285714 10.571429q-9.714286 17.714286 7.428571 25.714286 8 2.857143 16.571429 2.857143t12.571429-10.571429zm99.428571 61.142857q-25.714286 58.285714-90.285714 85.714286t-128 6.857143q-61.142857-19.428571-84.285714-72.285714t3.714286-107.142857q26.857143-53.142857 86.571429-79.428571t120.285714-10.857143q63.428571 16.571429 90.571429 68.285714t1.428571 108.857143zm178.285714-91.428571q-5.142857-54.857143-50.857143-97.142857t-119.142857-62.285714-156.857143-12q-127.428571 13.142857-211.142857 80.857143t-75.714286 151.142857q5.142857 54.857143 50.857143 97.142857t119.142857 62.285714 156.857143 12q127.428571-13.142857 211.142857-80.857143t75.714286-151.142857zm176 2.285714q0 38.857143-21.142857 79.714286t-62.285714 78.285714-96.285714 67.142857-129.142857 47.428571-154.571429 17.714286-157.142857-19.142857-137.428571-53.142857-98-86.285714-37.142857-114q0-65.714286 39.714286-140t112.857143-147.428571q96.571429-96.571429 195.142857-134.857143t140.857143 4q37.142857 36.571429 11.428571 119.428571-2.285714 8-0.571429 11.428571t5.714286 4 8.285714 2.857143 7.714286-2l3.428571-1.142857q79.428571-33.714286 140.571429-33.714286t87.428571 34.857143q25.714286 36 0 101.714286-1.142857 7.428571-2.571429 11.428571t2.571429 7.142857 6.857143 4.285714 9.714286 3.428571q32.571429 10.285714 58.857143 26.857143t45.714286 46.571429 19.428571 66.571429zm-42.285714-356.571429q24 26.857143 31.142857 62t-3.714286 67.142857q-4.571429 13.142857-16.857143 19.428571t-25.428571 2.285714q-13.142857-4.571429-19.428571-16.857143t-2.285714-25.428571q11.428571-36-13.714286-63.428571t-61.142857-20q-13.714286 2.857143-25.714286-4.571429t-14.285714-21.142857q-2.857143-13.714286 4.571429-25.428571t21.142857-14.571429q34.285714-7.428571 68 3.142857t57.714286 37.428571zm103.428571-93.142857q49.714286 54.857143 64.285714 127.142857t-7.714286 138q-5.142857 15.428571-19.428571 22.857143t-29.714286 2.285714-22.857143-19.428571-2.857143-29.714286q16-46.857143 5.714286-98.285714t-45.714286-90.285714q-35.428571-39.428571-84.571429-54.571429t-98.857143-4.857143q-16 3.428571-29.714286-5.428571t-17.142857-24.857143 5.428571-29.428571 24.857143-16.857143q70.285714-14.857143 139.428571 6.571429t118.857143 76.857143z"></path>
</svg>

    </a>
  
    <a href="https://www.toutiao.com/c/user/token/MS4wLjABAAAA1TxeVNQbqL6Lg7CJRoNwNHYDpIB5qKGh24pQ0AvIjmfeczyo5zxipIgPtGJr-mUI/?source=m_redirect" rel="me noopener" class="iconfont"
      title="toutiao"  target="_blank"
      >
      <svg t="1731818671552" class="icon" viewBox="0 0 1024 1024" version="1.1"
    xmlns="http://www.w3.org/2000/svg" p-id="4390" width="32" height="32">
    <path
        d="M828.745763 0H195.254237C86.779661 0 0 86.779661 0 195.254237v633.491526c0 108.474576 86.779661 190.915254 195.254237 195.254237h633.491526c108.474576 0 190.915254-86.779661 195.254237-195.254237V195.254237c0-108.474576-86.779661-195.254237-195.254237-195.254237z m138.847457 828.745763c0 78.101695-60.745763 138.847458-138.847457 138.847457H195.254237c-78.101695 0-138.847458-60.745763-138.847457-138.847457V195.254237c0-78.101695 60.745763-138.847458 138.847457-138.847457h633.491526c78.101695 0 138.847458 60.745763 138.847457 138.847457v633.491526z"
        fill="#525252" p-id="4391"></path>
    <path
        d="M0 221.288136v620.474576c0 4.338983 4.338983 8.677966 8.677966 13.016949l1015.322034-56.40678V182.237288c0-4.338983-4.338983-8.677966-8.677966-13.016949L0 221.288136z"
        fill="#525252" p-id="4392"></path>
    <path
        d="M906.847458 581.423729v-47.728814l-151.864407 8.677966V520.677966h-69.423729v30.372881l-151.864407 8.677967V607.457627l151.864407-8.677966v108.474576l69.423729-8.677966v-108.474576l151.864407-8.677966z"
        fill="#FFFFFF" p-id="4393"></path>
    <path
        d="M538.033898 490.305085v47.728813h47.728814l138.847457-69.423729 130.169492 47.728814H911.186441v-47.728814h-34.711865l-91.118644-26.033898 117.152543-60.745763V299.389831l-65.084746 4.338983-173.559322 8.677966-56.40678-30.372882-78.101695 117.152543 60.745763 21.694915 43.38983-60.745763 199.593221-8.677966v8.677966l-108.474577 56.40678-91.118644-34.711865-26.033898 47.728814 47.728814 21.694915-82.440678 43.389831-34.711865-4.338983z m334.101695 104.135593l-69.423729 8.677966 47.728814 91.118644 78.101695-8.677966-56.40678-91.118644z m-334.101695 108.474576H607.457627l47.728814-95.457627-69.423729 8.677966-47.728814 86.779661z m-169.220339-99.79661l56.40678 108.474576h82.440678l-60.745763-117.152542-78.101695 8.677966z m-78.101695-86.779661l-60.745762-78.101695-82.440678 8.677966 60.745762 69.423729h82.440678z m0-95.457627L229.966102 351.457627H147.525424l60.745762 78.101695 82.440678-8.677966z"
        fill="#FFFFFF" p-id="4394"></path>
    <path
        d="M351.457627 585.762712l130.169492-8.677966v-47.728814l-91.118644 8.677966v-216.949152l-65.084746 8.677966v208.271186l-216.949153 13.016949v47.728814l147.525424-8.677966-60.745763 82.440678-82.440678 8.677966v47.728814l138.847458-8.677967 99.79661-134.508474z"
        fill="#FFFFFF" p-id="4395"></path>
</svg>
    </a>


<a href="https://yutao.org/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
  
</div>

<div class="copyright">
    <span class="power-by">
        Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
    </span>
    <span class="division">|</span>
    <span class="theme-info">
        Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
    </span>

    <span class="copyright-year">
        &copy;
        
        2017 -
        2025
        <span class="heart">
            
            <i class="iconfont">
                <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

            </i>
        </span><span class="author">
            会写代码的小郎中
            
        </span></span>

    
    
    <span id="busuanzi_container">
        访客数/访问量：<span id="busuanzi_value_site_uv"></span>/<span id="busuanzi_value_site_pv"></span>
    </span>
    

    
    

    
</div>
      </footer>

      <div class="button__back-to-top">
        <a href="#back-to-top">
          <i class="iconfont">
            
            <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

          </i>
        </a>
      </div>
    </div>
    
<script type="text/javascript" src="https://yutao.org/lib/jquery/jquery-3.7.1.min.js"></script>
  <script type="text/javascript" src="https://yutao.org/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="https://yutao.org/js/main.54fc209990d2ffd16840055feb54ac66f05b31e000ac773fc8d9792e1b1a4246.js" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="https://yutao.org/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="https://yutao.org/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  




  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>













  <script src="https://yutao.org/js/copy-to-clipboard.js"></script>

  <script src="https://yutao.org/js/search.js"></script>


  </body>
</html>
